# Create Mood Playlist

## ユーザーストーリー (User Story)

Diggerとして、「あとで聴く」リストが大きくなりすぎた際、リストの中からその時の気分に合った楽曲をいくつか選び、聴きやすい長さのプレイリストを作成してほしい。なぜなら、リストが巨大だと試聴が億劫になるからだ。（気分、ジャンル、年代、ムード、完全ランダムなどの指定ができると嬉しい）

## ゴール (Goals)

- ユーザーが巨大化した「あとで聴く」リストから、現在の気分や好みに基づいて、試聴に適した長さの「今すぐ聴く」プレイリストを簡単に作成できるようにする。
- プレイリスト作成の際に、気分、ジャンル、年代、ムード、または完全ランダムといった条件を指定できるようにする。
- 「あとで聴く」リストの楽曲を効率的に消化し、新たな音楽との出会いを促進する。

## シナリオ (Scenarios)

**シナリオ1: 気分を指定して「今すぐ聴く」プレイリストを作成**

**前提 (Given):**

- ユーザーはQrateMateにログインしており、「あとで聴く」リストに複数の楽曲が保存されている。
- ユーザーは「今すぐ聴く」プレイリストを作成したいと考えている。

**操作 (When):**

1. ユーザーがQrateMateアプリ内で「今すぐ聴くプレイリスト作成」機能を選択する。
2. ユーザーがプレイリストの条件として「気分」を選択し、具体的な気分（例: 「リラックス」「集中したい」）を指定する。
3. （任意）ユーザーがプレイリストの長さ（曲数や時間）を指定する。
4. ユーザーがプレイリスト作成を実行する。

**結果 (Then):**

- 指定された気分に合致する楽曲が「あとで聴く」リストから選ばれ、「今すぐ聴く」プレイリスト（Spotifyの同名プレイリストと同期）が作成される。
- 作成されたプレイリストには、指定された長さの楽曲が含まれる。
- ユーザーにプレイリスト作成完了の通知が表示され、すぐに再生を開始できる。

## 受け入れ条件 (Acceptance Criteria)

- ユーザーは、「あとで聴く」リストの楽曲をソースとして「今すぐ聴く」プレイリストを作成できる。
- プレイリスト作成時に、少なくとも以下の条件を指定できる：気分、ジャンル、年代、ムード、完全ランダム。
- （任意）プレイリストの長さ（曲数または合計時間）を指定できる。
- 作成された「今すぐ聴く」プレイリストは、QrateMate内で確認・再生でき、Spotifyの同名のプレイリストと同期される。
- 「あとで聴く」リストに適切な楽曲がない場合、ユーザーにその旨が通知される。
- 楽曲のメタデータ（ジャンル、年代、ムードなど）が不足している場合でも、ランダム選択などのフォールバックがある。

## 技術的なメモ (任意)

- 「あとで聴く」リスト内の楽曲のメタデータ（Spotify APIから取得可能なジャンル、リリース年、audio featuresに基づくムード推定など）を活用する。
- 気分と楽曲特性のマッピングロジックを検討する。
- Spotify APIを利用して「今すぐ聴く」プレイリストを作成・更新する。
  - `POST /v1/users/{user_id}/playlists`
  - `POST /v1/playlists/{playlist_id}/tracks`
- プレイリスト生成ロジックはサーバーサイドで実行することも検討（処理負荷、メタデータ管理の観点から）。

## 対象外 (任意)

- ユーザーが手動で1曲ずつ選んで「今すぐ聴く」プレイリストを作成する機能（これは別ストーリーで扱う可能性あり）。
- 非常に複雑な条件の組み合わせによるプレイリスト生成。
