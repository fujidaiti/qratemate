# Save to Spotify Library

## ユーザーストーリー (User Story)

Diggerとして、視聴して気に入った音楽があった際、そのアイテム（曲、アルバム、アーティスト）をSpotifyのライブラリやプレイリストに素早く保存したい。なぜなら、後でまた聴きたくなった時にすぐに見つけられるように、自分の音楽ライブラリを一元管理したいからだ。

## ゴール (Goals)

- ユーザーがQrateMateの「あとで聴く」リストで試聴し気に入ったアイテム（曲、アルバム、アーティスト）を、簡単にSpotifyの自身のライブラリ（「マイライブラリ」の曲・アルバム）や指定のプレイリストに保存できるようにする。
- QrateMateで見つけた音楽を永続的にSpotify側で管理できるようにする。
- QrateMateからSpotifyへのシームレスな連携を提供する。

## シナリオ (Scenarios)

**シナリオ1: 気に入った曲をSpotifyライブラリに保存**

**前提 (Given):**

- ユーザーはQrateMateにログインしており、Spotifyアカウントが連携済みである。
- ユーザーは「あとで聴く」リスト内の曲を試聴し、それを気に入った。

**操作 (When):**

1. ユーザーが気に入った曲のアイテムメニューから「Spotifyライブラリに保存」を選択する。
2. QrateMateがSpotify APIを通じて対象の曲をユーザーのSpotifyライブラリ（「いいねした曲」）に追加する。

**結果 (Then):**

- 対象の曲がユーザーのSpotifyライブラリに追加される。
- ユーザーに保存完了のフィードバックが表示される。
- Spotifyアプリ側でもライブラリへの追加が確認できる。

**シナリオ2: 気に入ったアルバムをSpotifyの特定のプレイリストに保存**

**前提 (Given):**

- ユーザーはQrateMateにログインしており、Spotifyアカウントが連携済みである。
- ユーザーは「あとで聴く」リスト内のアルバムを試聴し、それを気に入った。
- ユーザーはSpotifyに保存先のプレイリスト（例: 「お気に入りアルバム集」）を持っている。

**操作 (When):**

1. ユーザーが気に入ったアルバムのアイテムメニューから「Spotifyプレイリストに保存」を選択する。
2. QrateMateがユーザーのSpotifyプレイリスト一覧を表示する。
3. ユーザーが保存先プレイリスト「お気に入りアルバム集」を選択する。
4. QrateMateがSpotify APIを通じて対象アルバムの全曲（または代表曲）をそのプレイリストに追加する。

**結果 (Then):**

- 対象アルバムの楽曲が指定されたSpotifyプレイリストに追加される。
- ユーザーに保存完了のフィードバックが表示される。

## 受け入れ条件 (Acceptance Criteria)

- ユーザーは、「あとで聴く」リスト内の気に入った曲をSpotifyの「マイライブラリ」（いいねした曲）に保存できる。
- ユーザーは、「あとで聴く」リスト内の気に入ったアルバムをSpotifyの「マイライブラリ」（アルバム）に保存できる。
- （任意）ユーザーは、「あとで聴く」リスト内の気に入ったアーティストをSpotifyでフォローできる。
- ユーザーは、「あとで聴く」リスト内のアイテム（曲、アルバムの曲）を、自身の既存のSpotifyプレイリストのいずれかを選択して追加できる。
- 保存操作はQrateMateアプリ内で完結する（Spotifyアプリへの遷移を強要しない）。

## 技術的なメモ (任意)

- Spotify APIの以下のエンドポイントを利用:
  - 曲のライブラリ保存: `PUT /v1/me/tracks`
  - アルバムのライブラリ保存: `PUT /v1/me/albums`
  - アーティストのフォロー: `PUT /v1/me/following`
  - プレイリスト一覧取得: `GET /v1/me/playlists`
  - プレイリストへの曲追加: `POST /v1/playlists/{playlist_id}/tracks`
- 必要なSpotify APIスコープ: `user-library-modify`, `playlist-read-private`, `playlist-modify-public`, `playlist-modify-private`, `user-follow-modify`.

## 対象外 (任意)

- QrateMate内で新しいSpotifyプレイリストを作成する機能（既存プレイリストへの追加を主とする）。
- 保存時にSpotifyプレイリスト内の曲順を指定する機能。
