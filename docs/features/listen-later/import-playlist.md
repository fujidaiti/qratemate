# Import Playlist

## ユーザーストーリー

Diggerとして、Spotifyの「あとで聴く」プレイリストを使っている既存のリストをQrateMateに簡単に引き継ぎたい。なぜなら、一から作り直すのは大変だからだ。

## ゴール

- ユーザーがSpotifyで既存の「あとで聴く」に相当するプレイリストをQrateMateへ簡単に移行できるようにする。
- 新規ユーザーがQrateMateを利用開始する際の障壁を下げ、既存の音楽リストを再構築する手間を省く。
- ユーザーが音楽発見のワークフローをQrateMate内で完結できるように支援する。

## シナリオ

**前提 (Given):**

- ユーザーはQrateMateにログインしており、Spotifyアカウントが連携済みである。
- ユーザーはSpotifyに「My Discoveries」（「あとで聴く」リストとして使用）という名前のプレイリストを持っており、これには20曲が保存されている。

**操作 (When):**

1. ユーザーがQrateMateアプリ内でインポート機能（例：「設定」画面の「Spotifyからインポート」）を選択する。
2. QrateMateがユーザーのSpotifyプレイリスト一覧を表示する。
3. ユーザーが一覧から「My Discoveries」プレイリストを選択する。
4. ユーザーがインポート実行を確定する。

**結果 (Then):**

- 「My Discoveries」プレイリスト内の全20曲が、QrateMateの「あとで聴く」リストに追加される。
- ユーザーに「20曲のインポートが完了しました」といった成功メッセージが表示される。
- インポートされた楽曲はQrateMateの「あとで聴く」セクションで確認・再生できる。

## 受け入れ条件 (Acceptance Criteria)

- ユーザーは、明確に識別できるUI要素からSpotifyプレイリストのインポート処理を開始できる。
- ユーザーに自身のSpotifyプレイリスト一覧が表示され、選択できる。
- ユーザーがインポート対象のプレイリストを1つ選択できる。
- インポート実行後、選択されたSpotifyプレイリストの全楽曲がQrateMateの「あとで聴く」リストに追加される。
- QrateMateの「あとで聴く」リストに既に存在するSpotify楽曲IDを持つトラックは、重複して追加されない。
- インポート処理に時間がかかる場合、進捗状況がユーザーに示される。
- 処理完了後、インポートされた楽曲数を記載した成功メッセージが表示される。
- インポート処理が失敗した場合（例：APIエラー、プレイリスト未選択）、適切なエラーメッセージが表示される。
- インポートされた楽曲は、QrateMate内で曲名、アーティスト名、アルバム名といった基本的なメタデータを保持する。

## UI/UX (任意)

- Spotifyプレイリスト選択画面のワイヤーフレーム/モックアップへのリンク。
- インポート確認ダイアログのデザイン。
- （任意）多数のプレイリストを持つユーザー向けの絞り込みや検索機能の検討。

## 技術的なメモ (任意)

- Spotify APIのOAuth 2.0フローを利用して認証を行う。
- 以下のSpotify APIエンドポイントを利用する：
  - `GET /v1/me/playlists` （ユーザーのプレイリスト一覧取得）
  - `GET /v1/playlists/{playlist_id}/tracks` （選択されたプレイリストの楽曲取得）
- API呼び出しおよびデータ処理に関する堅牢なエラーハンドリングを実装する。
- 大量の楽曲を含むプレイリストのインポートを考慮し、Spotify APIのレート制限に注意する。
- QrateMateの「あとで聴く」リストのデータモデルには、重複排除や将来的な同期のためにSpotify Track IDを格納する。

## 対象外 (任意)

- SpotifyプレイリストとQrateMate「あとで聴く」リスト間の継続的な自動同期（これは別のストーリーで扱う）。
- Spotify以外の音楽サービスからのインポート。
- インポート先のリストをユーザーが選択する機能（このストーリーでは「あとで聴く」リストへのインポートをデフォルトとする）。

## 補足事項 (任意)

- この機能は、ユーザーのオンボーディングとサービス定着における重要な基盤となる。
