# Save Spotify Artist

## ユーザーストーリー

Diggerとして、アーティスト単位でSpotifyからQrateMateの「あとで聴く」リストに保存したい。なぜなら、漠然とそのアーティストが気になっているだけで、聴きたい曲が特に決まっているわけではないからだ。

## ゴール

- Spotifyの標準的な操作（曲を特定のプレイリストに追加）を通じて、QrateMateの「あとで聴く」にアーティストを保存できる。

## シナリオ

**前提 (Given):**

- ユーザーはQrateMateにSpotifyアカウントでログインしている。
- Spotify側に「あとで聴くアーティスト」という名前のプレイリストが存在する。
- ユーザーはSpotifyアプリで、保存したいアーティスト（例："Vulfpeck"）の任意の曲（例："Wait for the Moment"）を特定している。

**操作 (When):**

1. ユーザーがSpotifyアプリ内で、アーティスト"Vulfpeck"の曲"Wait for the Moment"を「あとで聴くアーティスト」プレイリストに追加する。

**結果 (Then):**

- 曲"Wait for the Moment"の筆頭アーティストである"Vulfpeck"が、QrateMateの「あとで聴く」リストに（アーティストとして）自動的に追加される。
- ユーザーが、対象のアーティストがQrateMateの「あとで聴く」に追加されたことを（次回アプリ起動時などに）確認できる。

## 受け入れ条件 (Acceptance Criteria)

- ユーザーがSpotifyの「あとで聴くアーティスト」プレイリストに曲を追加すると、その曲の筆頭アーティストがQrateMateの「あとで聴く」リストにアーティストとして同期される。
- QrateMateの「あとで聴く」リストには、アーティストが正しく保存・表示される。
- 同期処理はアプリ起動時、またはユーザーによる手動発火(pull-to-refreshなど)でバックグラウンドで行われる。
- 既にリストに存在する同じSpotify IDのアーティストは、QrateMateの「あとで聴く」には重複追加されない。
- 保存された曲に複数のアーティストがいる場合でも、筆頭のアーティストのみがQrateMateに保存される。

## 備考

- Spotify上の「あとで聴くアーティスト」プレイリストは、QrateMateの初回オンボーディング時に自動で作成される。
- QrateMateとSpotifyアカウントの連携設定が完了している必要がある。
- 同期処理のため、Spotify APIを利用して指定プレイリストを監視する。
  - 「あとで聴くアーティスト」プレイリスト内の曲から筆頭アーティストID (`track.artists[0].id`) を抽出し、アーティスト情報を取得・保存する。
- QrateMateの「あとで聴く」リストのアイテムは、タイプ（アーティスト）とSpotify IDを明確に持つ必要がある。
- Spotifyアプリ内でアーティストページから直接QrateMateの特定のリストに送る機能は対象外とする（現状のSpotifyの仕様ではプレイリストへの曲追加が基本となるため）。
- 複数のアーティストがいる場合に、全アーティストを保存するオプションは対象外とし、筆頭アーティストのみを保存する。
